<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Browser Summary</title>

	<style type="text/css">
		html * {
			font-size: 1em !important;
		}

		code {
			font-family: 'Monaco';
		}

		#refresh {
			position: fixed;
			top: 10px;
			right: 10px;
		}
	</style>
</head>
<body style='font-size: 1rem'>

<label>
	<code>html { font-size: </code>
		<select id='rem'>
			<optgroup label='rem'>
				<option value='1rem'>1rem</option>
				<option value='1.25rem'>1.25rem</option>
			</optgroup>

			<optgroup label='px'>
				<option value='16px'>16px</option>
				<option value='20px'>20px</option>
			</optgroup>

			<optgroup label='100%'>
				<option value='100%'>100%</option>
				<option value='125%'>125%</option>
			</optgroup>

		</select> 
	<code> }</code>
</label>	

	<article id='summary'>
		<div>

			<h3>User agent</h3>
			<p><code data-prop='ua'></code></p>

			<h3>Window size</h3>
			<p>
				<code>outerWidth</code> &times; <code>outerHeight</code>:
				<code data-prop='w-outer-width'></code> &times; 
				<code data-prop='w-outer-height'></code>
			</p>

			<p>
				<code>innerWidth</code> &times; <code>innerHeight</code>:
				<code data-prop='w-inner-width'></code> &times; 
				<code data-prop='w-inner-height'></code>
			</p>

			<h3>CSS units</h3>
			
			<p><code>1rem</code> = <code data-prop='one-rem'></code></p>


			<h3>Media Queries</h3>

			<table>
				<thead>
					<tr>
						<th>Media Query</th>
						<th>Value </th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>
							<code>min-width</code>*
						</td>
						<td>
							<code data-prop='mq-min-w-px'></code> or <code data-prop='mq-min-w-rem'></code> 
						</td>
					</tr>
					<tr>
						<td>
							<code>min-height</code>*
						</td>
						<td>
							<code data-prop='mq-min-h-px'></code> or <code data-prop='mq-min-h-rem'></code>
						</td>
					</tr>
					<tr>
						<td>
							<code>min-device-width</code>*
						</td>
						<td>
							<code data-prop='mq-min-dw-px'></code> or <code data-prop='mq-min-dw-rem'></code>
						</td>
					</tr>
					<tr>
						<td>
							<code>min-device-height</code>*
						</td>
						<td>
							<code data-prop='mq-min-dh-px'></code> or <code data-prop='mq-min-dh-rem'></code>
						</td>
					</tr>
				</tbody>
			</table>

			<p>In media queries, <code>1rem</code> ~ <code data-prop='mq-rem-px'></code>px</p>

			<p>* Largest value that matches via binary search.</p>

			<button id='refresh'>Refresh</button>
		</div>
	</article>

	<script>

		function evaluate() {

			let mq = (key, unit) => {

				let start = 0;
				let end = unit === 'rem' ? 1 * 1000 * 100 : 1 * 1000 * 1000;

				return () => {
					let iteration = 0;
					while(end - start >= 1 && ++iteration < 1000) {
						let middle = start + (end - start) / 2;
						if (matchMedia(`(${key}: ${middle}${unit})`).matches) {
							start = middle;
						} else {
							end = middle;
						}
					}
					if (iteration >= 1000) {
						alert(`binary search infinite loop: ${start} / ${end}`);
					}
					return unit === 'rem' ? `${start}${unit}` : `${Math.round(start)}${unit}`;
				}
			};

			let props = {
				'ua': () => navigator.userAgent,
				'w-outer-width': () => window.outerWidth,
				'w-outer-height': () => window.outerHeight,
				'w-inner-width': () => window.innerWidth,
				'w-inner-height': () => window.innerHeight,
				'one-rem': () => getComputedStyle(document.body).fontSize,
				'mq-min-w-px': mq('min-width', 'px'),
				'mq-min-w-rem': mq('min-width', 'rem'),
				'mq-min-h-px': mq('min-height', 'px'),
				'mq-min-h-rem': mq('min-height', 'rem'),
				'mq-min-dw-px': mq('min-device-width', 'px'),
				'mq-min-dw-rem': mq('min-device-width', 'rem'),
				'mq-min-dh-px': mq('min-device-height', 'px'),
				'mq-min-dh-rem': mq('min-device-height', 'rem'),
				'mq-rem-px': () => {
					let px = parseFloat(mq('min-width', 'px')().replace(/px$/, ''));
					let rem = parseFloat(mq('min-width', 'rem')().replace(/rem$/, ''));
					return Math.round(px/rem);
				}
			};

			Object.entries(props).forEach(([k, v]) => {
				document.querySelector(`[data-prop=${k}]`).innerText = v();
			});

		}


		let rem = document.querySelector('#rem');
		
		const setRem = () => document.documentElement.style.fontSize = rem.value;

		rem.addEventListener('change', e => {
			setRem();
			evaluate();
		});
		
		setRem();
		window.addEventListener('load', evaluate);

		document.querySelector('#refresh').addEventListener('click', evaluate);

	</script>
</body>
</html>